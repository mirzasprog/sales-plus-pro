<section class="positions">
  <div class="panel">
    <div class="toolbar">
      <form [formGroup]="filterForm" class="filter">
        <input type="search" placeholder="Pretraži pozicije..." formControlName="search" />
        <select formControlName="status">
          <option value="">Status</option>
          <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
        </select>
        <select formControlName="supplier">
          <option value="">Dobavljač</option>
          <option *ngFor="let supplier of suppliers$ | async" [value]="supplier.id">{{ supplier.name }}</option>
        </select>
        <select formControlName="type">
          <option value="">Tip elementa</option>
          <option *ngFor="let type of positionTypes$ | async" [value]="type">{{ type }}</option>
        </select>
      </form>
      <button type="button" class="secondary" (click)="exportReport()">Izvezi XLSX</button>
    </div>

    <form [formGroup]="createForm" class="create" novalidate (ngSubmit)="addPosition()">
      <div class="field-grid">
        <label>
          Naziv pozicije
          <input type="text" formControlName="name" placeholder="End-cap, gondola..." required />
        </label>
        <label>
          Objekat
          <select formControlName="retailObjectId" required>
            <option value="" disabled>Odaberi objekat</option>
            <option *ngFor="let store of stores$ | async" [value]="store.id">{{ store.name }}</option>
          </select>
        </label>
        <label>
          Tip pozicije
          <input type="text" formControlName="positionType" placeholder="Stalak, police" required />
        </label>
        <label>
          Status
          <select formControlName="status" required>
            <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
          </select>
        </label>
        <label>
          Dobavljač
          <select formControlName="supplierId">
            <option value="">(opcionalno)</option>
            <option *ngFor="let supplier of suppliers$ | async" [value]="supplier.id">{{ supplier.name }}</option>
          </select>
        </label>
        <label>
          Širina (cm)
          <input type="number" min="1" formControlName="widthCm" />
        </label>
        <label>
          Visina (cm)
          <input type="number" min="1" formControlName="heightCm" />
        </label>
        <label class="full">
          Napomena
          <textarea rows="2" formControlName="note" placeholder="Dodatni detalji"></textarea>
        </label>
      </div>
      <div class="actions">
        <button type="submit">Dodaj poziciju</button>
      </div>
    </form>

    <form
      *ngIf="editingPosition"
      [formGroup]="editForm"
      class="create"
      novalidate
      (ngSubmit)="saveEdit()"
    >
      <div class="form-header">
        <div>
          <p class="eyebrow">Uredi poziciju</p>
          <h3>{{ editingPosition?.name }}</h3>
        </div>
        <button type="button" class="ghost" (click)="cancelEdit()">Zatvori</button>
      </div>
      <div class="field-grid">
        <label>
          Naziv pozicije
          <input type="text" formControlName="name" placeholder="End-cap, gondola..." required />
        </label>
        <label>
          Objekat
          <select formControlName="retailObjectId" required>
            <option value="" disabled>Odaberi objekat</option>
            <option *ngFor="let store of stores$ | async" [value]="store.id">{{ store.name }}</option>
          </select>
        </label>
        <label>
          Tip pozicije
          <input type="text" formControlName="positionType" placeholder="Stalak, police" required />
        </label>
        <label>
          Status
          <select formControlName="status" required>
            <option *ngFor="let status of statusOptions" [value]="status">{{ status }}</option>
          </select>
        </label>
        <label>
          Dobavljač
          <select formControlName="supplierId">
            <option value="">(opcionalno)</option>
            <option *ngFor="let supplier of suppliers$ | async" [value]="supplier.id">{{ supplier.name }}</option>
          </select>
        </label>
        <label>
          Širina (cm)
          <input type="number" min="1" formControlName="widthCm" />
        </label>
        <label>
          Visina (cm)
          <input type="number" min="1" formControlName="heightCm" />
        </label>
        <label class="full">
          Napomena
          <textarea rows="2" formControlName="note" placeholder="Dodatni detalji"></textarea>
        </label>
      </div>
      <div class="actions">
        <button type="submit">Sačuvaj izmjene</button>
      </div>
    </form>
  </div>

  <div class="position-list" *ngIf="positions$ | async as positions">
    <article class="card position" *ngFor="let position of positions">
      <header>
        <h2>{{ position.name }}</h2>
        <app-position-status-badge [status]="position.status"></app-position-status-badge>
      </header>
      <p class="meta">{{ position.retailObjectName }} • {{ position.positionType }}</p>
      <p class="muted" *ngIf="position.supplier">Dobavljač: {{ position.supplier }}</p>
      <p class="muted">Dimenzije: {{ position.widthCm }}×{{ position.heightCm }} cm</p>
      <footer>
        <div class="button-row">
          <button type="button" class="ghost" (click)="startEdit(position)">Uredi</button>
          <button type="button" (click)="markInactive(position)">Označi kao neaktivno</button>
        </div>
      </footer>
    </article>
  </div>
</section>
