<section class="page-header">
  <div>
    <p class="eyebrow">Dobavljači</p>
    <h1>Partneri i zakup ugovori</h1>
    <p class="muted">Pregled aktivnih ugovora, pokrivenosti po objektima i narednih isteka.</p>
  </div>
  <div class="forms">
    <div class="filters">
      <form [formGroup]="filterForm" novalidate>
        <label>
          Pretraga
          <input type="search" formControlName="search" placeholder="Naziv dobavljača" />
        </label>
        <label>
          Kategorija
          <input type="text" formControlName="category" placeholder="prehrana, kozmetika..." />
        </label>
      </form>
      <button type="button" class="secondary" (click)="exportReport()">Izvezi XLSX</button>
    </div>

    <form [formGroup]="createForm" class="create" novalidate (ngSubmit)="addSupplier()">
      <div class="field-pair">
        <label>
          Naziv dobavljača
          <input type="text" formControlName="name" placeholder="Novi partner" required />
        </label>
        <label>
          Kategorija
          <input type="text" formControlName="category" placeholder="prehrana, kozmetika..." required />
        </label>
      </div>

      <div class="field-grid">
        <label>
          Aktivni ugovori
          <input type="number" min="0" formControlName="activeContracts" />
        </label>
        <label>
          Aktivni objekti
          <input type="number" min="0" formControlName="activeStores" />
        </label>
        <label>
          Aktivne pozicije
          <input type="number" min="0" formControlName="activePositions" />
        </label>
        <label>
          Prihod (EUR)
          <input type="number" min="0" formControlName="activeRevenue" />
        </label>
        <label>
          Sljedeći isteka
          <input type="date" formControlName="nextExpiry" />
        </label>
      </div>

      <div class="actions">
        <button type="submit">Dodaj dobavljača</button>
      </div>
    </form>

    <form
      *ngIf="editingSupplier"
      [formGroup]="editForm"
      class="create"
      novalidate
      (ngSubmit)="saveEdit()"
    >
      <div class="form-header">
        <div>
          <p class="eyebrow">Uredi dobavljača</p>
          <h3>{{ editingSupplier?.name }}</h3>
        </div>
        <button type="button" class="ghost" (click)="cancelEdit()">Zatvori</button>
      </div>

      <div class="field-pair">
        <label>
          Naziv dobavljača
          <input type="text" formControlName="name" placeholder="Novi partner" required />
        </label>
        <label>
          Kategorija
          <input type="text" formControlName="category" placeholder="prehrana, kozmetika..." required />
        </label>
      </div>

      <div class="field-grid">
        <label>
          Aktivni ugovori
          <input type="number" min="0" formControlName="activeContracts" />
        </label>
        <label>
          Aktivni objekti
          <input type="number" min="0" formControlName="activeStores" />
        </label>
        <label>
          Aktivne pozicije
          <input type="number" min="0" formControlName="activePositions" />
        </label>
        <label>
          Prihod (EUR)
          <input type="number" min="0" formControlName="activeRevenue" />
        </label>
        <label>
          Sljedeći isteka
          <input type="date" formControlName="nextExpiry" />
        </label>
      </div>

      <div class="actions">
        <button type="submit">Sačuvaj izmjene</button>
      </div>
    </form>
  </div>
</section>

<section class="card" *ngIf="suppliers$ | async as suppliers">
  <header class="card__header">
    <h2>Aktivni dobavljači</h2>
    <span class="muted">{{ suppliers.length }} partnera</span>
  </header>
  <div class="table">
    <div class="table__head">
      <div>Dobavljač</div>
      <div>Kategorija</div>
      <div>Objekti</div>
      <div>Pozicije</div>
      <div>Ugovori</div>
      <div>Aktivni prihod</div>
      <div>Sljedeći isteka</div>
      <div>Akcije</div>
    </div>
    <div class="table__row" *ngFor="let supplier of suppliers">
      <div>
        <div class="title">{{ supplier.name }}</div>
        <div class="muted">#{{ supplier.id | slice:0:6 }}</div>
      </div>
      <div>{{ supplier.category || 'N/A' }}</div>
      <div>{{ supplier.activeStores }}</div>
      <div>{{ supplier.activePositions }}</div>
      <div>{{ supplier.activeContracts }}</div>
      <div>{{ supplier.activeRevenue | currency: 'EUR' : 'symbol' : '1.0-0' }}</div>
      <div>
        <span class="badge warning" *ngIf="supplier.nextExpiry as expiry">{{ expiry | date: 'dd.MM.yyyy' }}</span>
        <span class="muted" *ngIf="!supplier.nextExpiry">nema</span>
      </div>
      <div>
        <button type="button" class="ghost" (click)="startEdit(supplier)">Uredi</button>
      </div>
    </div>
  </div>
</section>
